<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DeepCoder Static Space</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        ::placeholder {
            color: #9ca3af; /* gray-400 */
        }
        button:hover:not(:disabled) { /* Apply hover only when not disabled */
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Basic spinner animation */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            width: 1em; /* Size relative to font size */
            height: 1em;
            animation: spin 1s linear infinite;
            display: inline-block; /* Keep it inline */
            margin-left: 0.5em; /* Space it from text */
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Hide spinner by default */
        .spinner.hidden {
            display: none;
        }
        /* Style for code block */
        #outputCode {
            font-family: 'Courier New', Courier, monospace; /* Monospace font */
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white rounded-xl shadow-2xl overflow-hidden w-full max-w-4xl">
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 p-6 text-white">
            <h1 class="text-3xl font-bold">DeepCoder Static Space</h1>
            <p class="mt-1 text-blue-100">Generate code snippets from descriptions or examples.</p>
        </div>

        <div class="p-6 md:p-8 grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">

            <div class="space-y-4">
                <h2 class="text-xl font-semibold text-gray-800">Input Description</h2>
                <textarea
                    id="inputDescription"
                    rows="10"
                    class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out text-gray-700 placeholder-gray-400 resize-none"
                    placeholder="Describe the function or provide input/output examples...\ne.g., 'Write a python function that takes a list of integers and returns the sum.'"
                ></textarea>
                <button
                    id="generateBtn"
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-md shadow-md transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <span>Generate Code</span>
                    <span id="spinner" class="spinner hidden"></span> </button>
            </div>

            <div class="space-y-4">
                 <h2 class="text-xl font-semibold text-gray-800">Generated Code</h2>
                 <div class="bg-gray-900 rounded-md p-4 overflow-x-auto h-[280px] md:h-auto md:min-h-[280px]">
                    <pre><code id="outputCode" class="text-sm text-gray-200 block whitespace-pre-wrap">// Generated code will appear here...</code></pre>
                 </div>
                 <p class="text-sm text-gray-500">
                    You can modify this app by editing <code>index.html</code>.
                    Check the <a href="https://huggingface.co/docs/hub/spaces" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline">Spaces documentation</a>.
                 </p>
            </div>
        </div>

        <div class="bg-gray-50 p-4 text-center text-xs text-gray-500 border-t border-gray-200">
            Powered by Hugging Face Spaces
        </div>
    </div>

    <script type="module">
        // Import the InferenceClient from a CDN (e.g., jsDelivr)
        import { InferenceClient } from "https://cdn.jsdelivr.net/npm/@huggingface/inference@2.9.1/+esm";

        // --- DOM Elements ---
        const generateBtn = document.getElementById('generateBtn');
        const inputDescription = document.getElementById('inputDescription');
        const outputCode = document.getElementById('outputCode');
        const spinner = document.getElementById('spinner');

        // --- Configuration ---
        // IMPORTANT: Replace with your actual token ONLY if absolutely necessary for testing.
        // DO NOT commit your real token to public repositories or deploy it client-side.
        // Consider using environment variables or a backend proxy in production.
        const HF_TOKEN = "hf_xxxxxxxxxxxxxxxxxxxxxxxx"; // Use the placeholder or your test token cautiously
        const client = new InferenceClient(HF_TOKEN);

        // --- Event Listener ---
        generateBtn.addEventListener('click', async () => {
            const description = inputDescription.value.trim();
            if (!description) {
                outputCode.textContent = "// Please provide a description first.";
                return;
            }

            // --- UI Update: Start Loading ---
            generateBtn.disabled = true; // Disable button
            spinner.classList.remove('hidden'); // Show spinner
            outputCode.textContent = "// Generating code..."; // Clear previous output

            try {
                let fullResponse = ""; // Accumulate the response

                // --- Call HF Inference API ---
                const stream = await client.chatCompletionStream({
                    provider: "nebius", // Or your desired provider
                    model: "deepseek-ai/DeepSeek-V3", // Or your desired model
                    messages: [
                        {
                            role: "user",
                            // Use the actual description from the textarea
                            content: description,
                        },
                    ],
                    max_tokens: 512, // Adjust as needed
                });

                // --- Process Stream ---
                for await (const chunk of stream) {
                    if (chunk.choices && chunk.choices.length > 0 && chunk.choices[0].delta) {
                        const newContent = chunk.choices[0].delta.content;
                        if (newContent) { // Check if content exists
                            fullResponse += newContent;
                            // Update the output progressively
                            outputCode.textContent = fullResponse;
                        }
                    }
                }

                // Handle cases where the stream might end without content (optional)
                if (!fullResponse) {
                     outputCode.textContent = "// Received an empty response from the model.";
                }

            } catch (error) {
                // --- Error Handling ---
                console.error("Error during code generation:", error);
                outputCode.textContent = `// Error generating code:\n// ${error.message}\n\n// Check the console (F12) for more details.`;
                // Consider more specific error messages based on error type if needed
            } finally {
                // --- UI Update: Stop Loading ---
                generateBtn.disabled = false; // Re-enable button
                spinner.classList.add('hidden'); // Hide spinner
            }
        });
    </script>

</body>
</html>
